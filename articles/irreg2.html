<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interpolating irregular data • guerrilla</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Interpolating irregular data">
<meta property="og:description" content="guerrilla">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">guerrilla</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/irreg2.html">Interpolating irregular data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hypertidy/guerrilla/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="irreg2_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Interpolating irregular data</h1>
                        <h4 class="author">Michael D. Sumner</h4>
            
            <h4 class="date">2021-07-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hypertidy/guerrilla/blob/master/vignettes/irreg2.Rmd"><code>vignettes/irreg2.Rmd</code></a></small>
      <div class="hidden name"><code>irreg2.Rmd</code></div>

    </div>

    
    
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>Define utility functions for repeated usage, and load required packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/guerrilla">guerrilla</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: sp</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/gstat/">gstat</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/NCAR/Fields">fields</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: spam</span>
<span class="co">#&gt; Loading required package: dotCall64</span>
<span class="co">#&gt; Loading required package: grid</span>
<span class="co">#&gt; Spam version 2.7-0 (2021-06-25) is loaded.</span>
<span class="co">#&gt; Type 'help( Spam)' or 'demo( spam)' for a short introduction </span>
<span class="co">#&gt; and overview of this package.</span>
<span class="co">#&gt; Help for individual functions is also obtained by adding the</span>
<span class="co">#&gt; suffix '.spam' to the function name, e.g. 'help( chol.spam)'.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'spam'</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     backsolve, forwardsolve</span>
<span class="co">#&gt; Loading required package: viridis</span>
<span class="co">#&gt; Loading required package: viridisLite</span>
<span class="co">#&gt; See https://github.com/NCAR/Fields for</span>
<span class="co">#&gt;  an extensive vignette, other supplements and source code</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">akima</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AustralianAntarcticDivision/palr">palr</a></span><span class="op">)</span></code></pre></div>
<p>Read the zooplankton data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span>
<span class="va">bw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"BW-Zooplankton_env.xls"</span>, package<span class="op">=</span> <span class="st">"guerrilla"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bw</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;     Station            Lat              Lon            depth     </span>
<span class="co">#&gt;  Min.   :  4.00   Min.   :-69.11   Min.   :29.98   Min.   : 175  </span>
<span class="co">#&gt;  1st Qu.: 37.25   1st Qu.:-66.84   1st Qu.:40.00   1st Qu.:1523  </span>
<span class="co">#&gt;  Median : 60.00   Median :-65.84   Median :55.06   Median :3065  </span>
<span class="co">#&gt;  Mean   : 64.36   Mean   :-65.46   Mean   :54.60   Mean   :2791  </span>
<span class="co">#&gt;  3rd Qu.:100.25   3rd Qu.:-64.09   3rd Qu.:70.00   3rd Qu.:4114  </span>
<span class="co">#&gt;  Max.   :122.00   Max.   :-61.66   Max.   :80.02   Max.   :5075  </span>
<span class="co">#&gt;       temp              sal         chl a mg/m2)       ASC (km)      </span>
<span class="co">#&gt;  Min.   :-1.6712   Min.   :33.93   Min.   : 29.60   Min.   :-39.600  </span>
<span class="co">#&gt;  1st Qu.:-1.4726   1st Qu.:34.14   1st Qu.: 44.91   1st Qu.:  4.125  </span>
<span class="co">#&gt;  Median :-1.1332   Median :34.25   Median : 53.00   Median :114.950  </span>
<span class="co">#&gt;  Mean   :-0.6755   Mean   :34.22   Mean   : 76.80   Mean   :187.506  </span>
<span class="co">#&gt;  3rd Qu.: 0.1435   3rd Qu.:34.31   3rd Qu.: 85.57   3rd Qu.:330.550  </span>
<span class="co">#&gt;  Max.   : 0.8815   Max.   :34.42   Max.   :352.51   Max.   :775.500  </span>
<span class="co">#&gt;  ice free days     Total abundance   </span>
<span class="co">#&gt;  Min.   :-35.322   Min.   :   459.3  </span>
<span class="co">#&gt;  1st Qu.:  6.108   1st Qu.:  4425.9  </span>
<span class="co">#&gt;  Median : 33.153   Median : 11346.1  </span>
<span class="co">#&gt;  Mean   : 33.139   Mean   : 23609.3  </span>
<span class="co">#&gt;  3rd Qu.: 62.901   3rd Qu.: 27417.3  </span>
<span class="co">#&gt;  Max.   :101.420   Max.   :116715.8</span>
<span class="va">lonlat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">bw</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lon"</span>, <span class="st">"Lat"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">val</span> <span class="op">&lt;-</span> <span class="va">bw</span><span class="op">$</span><span class="va">temp</span>
<span class="va">minmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.8</span>, <span class="fl">40</span><span class="op">)</span>

<span class="va">rval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/pretty.html">pretty</a></span><span class="op">(</span><span class="va">val</span>, n <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>

<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/palr/man/sst_pal.html">sst_pal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rval</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>Plot the temperature data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span></code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>Create a grid to interpolate onto, this can be used repeatedly for many methods.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span>

<span class="va">r0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defaultgrid.html">defaultgrid</a></span><span class="op">(</span><span class="va">lonlat</span><span class="op">)</span></code></pre></div>
</div>
<div id="simplistic-rasterization" class="section level1">
<h1 class="hasAnchor">
<a href="#simplistic-rasterization" class="anchor"></a>Simplistic rasterization</h1>
<p>The most simple thing possible is to define a grid and populate that with values from points.</p>
<p>We extend the grid by a small amount, which is generally good practice.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rasgrid</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xy</span>, <span class="va">value</span>, <span class="va">grid</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span> <span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defaultgrid.html">defaultgrid</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span>
   <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterize.html">rasterize</a></span><span class="op">(</span><span class="va">xy</span>, <span class="va">grid</span>, field <span class="op">=</span> <span class="va">value</span>, <span class="va">...</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">lastgrid</span> <span class="op">&lt;-</span> <span class="fu">rasgrid</span><span class="op">(</span><span class="va">lonlat</span>, <span class="va">val</span>, <span class="va">r0</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">lastgrid</span>, asp <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>The main influence on the result here is purely pixel size, and we must consider the behaviour used when there is more than one value per pixel.</p>
</div>
<div id="thin-plate-spline-interpolation-" class="section level1">
<h1 class="hasAnchor">
<a href="#thin-plate-spline-interpolation-" class="anchor"></a>Thin plate spline interpolation.</h1>
<p>This is the powerhouse behind GDAL’s raster warping, and that suggests that we could leverage GDAL by creating a data set in the right format for it to warp to.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/NCAR/Fields">fields</a></span><span class="op">)</span>
<span class="va">tpsfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xy</span>, <span class="va">value</span>, <span class="va">grid</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span> <span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defaultgrid.html">defaultgrid</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span>
  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fields/man/Tps.html">Tps</a></span><span class="op">(</span><span class="va">xy</span>, <span class="va">value</span>, lon.lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/isLonLat.html">isLonLat</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"REML"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/interpolate.html">interpolate</a></span><span class="op">(</span><span class="va">grid</span>, <span class="va">model</span>, <span class="va">...</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">tpsgrid</span>  <span class="op">&lt;-</span> <span class="fu">tpsfun</span><span class="op">(</span><span class="va">lonlat</span>, <span class="va">val</span><span class="op">)</span>
<span class="va">tpsgrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/clamp.html">clamp</a></span><span class="op">(</span><span class="va">tpsgrid</span>, <span class="va">minmax</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">minmax</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>

<span class="co">## this shows the error</span>
<span class="va">tpsSEgrid</span> <span class="op">&lt;-</span> <span class="fu">tpsfun</span><span class="op">(</span><span class="va">lonlat</span>, <span class="va">val</span>, <span class="va">r0</span>, fun <span class="op">=</span> <span class="va">predictSE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">tpsgrid</span>, asp <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div id="bilinear-triangulation-" class="section level1">
<h1 class="hasAnchor">
<a href="#bilinear-triangulation-" class="anchor"></a>Bilinear triangulation.</h1>
<p>This is identical to Matlab’s griddata(, method = “bilinear”)</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://davidcsterratt.github.io/geometry">geometry</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/">sp</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/guerrilla">guerrilla</a></span><span class="op">)</span>


<span class="va">trigrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tri_fun.html">tri_fun</a></span><span class="op">(</span><span class="va">lonlat</span>, <span class="va">val</span>, <span class="va">r0</span><span class="op">)</span>
<span class="co">## should be identical, generalizing for mesh3d use</span>
<span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mesh_raster.html">mesh_raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">lonlat</span>, <span class="va">val</span><span class="op">)</span>, <span class="va">r0</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">trigrid</span>, asp <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div id="delaunay-and-diriclet" class="section level1">
<h1 class="hasAnchor">
<a href="#delaunay-and-diriclet" class="anchor"></a>Delaunay and Diriclet</h1>
<p>What about Delaunay and Dirichlet without interpolation?</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">graphics.off</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## input must be ppp</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://spatstat.org/">spatstat.geom</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: spatstat.data</span>
<span class="co">#&gt; spatstat.geom 2.2-0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'spatstat.geom'</span>
<span class="co">#&gt; The following object is masked from 'package:palr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     col2hex</span>
<span class="co">#&gt; The following objects are masked from 'package:raster':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     area, rotate, shift</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://maptools.r-forge.r-project.org/">maptools</a></span><span class="op">)</span>
<span class="co">#&gt; Checking rgeos availability: FALSE</span>
<span class="co">#&gt;      Note: when rgeos is not available, polygon geometry     computations in maptools depend on gpclib,</span>
<span class="co">#&gt;      which has a restricted licence. It is disabled by default;</span>
<span class="co">#&gt;      to enable gpclib, type gpclibPermit()</span>
<span class="va">rasterToOwin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/owin.html">owin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/coordinates.html">xmin</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/coordinates.html">xmax</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/coordinates.html">ymin</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/coordinates.html">ymax</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">colfun</span> <span class="op">&lt;-</span> <span class="fu">viridis</span><span class="fu">::</span><span class="va"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span>
<span class="va">rbase</span> <span class="op">&lt;-</span> <span class="va">r0</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="va">bw</span>
<span class="va">xname</span> <span class="op">&lt;-</span> <span class="st">"Lon"</span>
<span class="va">yname</span> <span class="op">&lt;-</span> <span class="st">"Lat"</span>
<span class="va">varname</span> <span class="op">&lt;-</span> <span class="st">"temp"</span>
<span class="va">pObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/ppp.html">ppp</a></span><span class="op">(</span><span class="va">d</span><span class="op">[[</span><span class="va">xname</span><span class="op">]</span><span class="op">]</span>, <span class="va">d</span><span class="op">[[</span><span class="va">yname</span><span class="op">]</span><span class="op">]</span>, window <span class="op">=</span> <span class="fu">rasterToOwin</span><span class="op">(</span><span class="va">rbase</span><span class="op">)</span>, marks <span class="op">=</span> <span class="va">d</span><span class="op">[[</span><span class="va">varname</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>

<span class="va">lltes</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/delaunay.html">delaunay</a></span><span class="op">(</span><span class="va">pObj</span><span class="op">)</span>
<span class="va">meanval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lltes</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">meanval</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">meanval</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/marks.html">marks</a></span><span class="op">(</span><span class="va">pObj</span><span class="op">[</span><span class="va">lltes</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
       <span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fu">as</span><span class="op">(</span><span class="va">lltes</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu">colfun</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">[</span><span class="fu">scl</span><span class="op">(</span><span class="va">meanval</span><span class="op">)</span><span class="op">*</span><span class="fl">19</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, asp <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">d</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">xname</span>, <span class="va">yname</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>

<span class="va">lltes</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/dirichlet.html">dirichlet</a></span><span class="op">(</span><span class="va">pObj</span><span class="op">)</span>
<span class="va">meanval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lltes</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">meanval</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">meanval</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/marks.html">marks</a></span><span class="op">(</span><span class="va">pObj</span><span class="op">[</span><span class="va">lltes</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fu">as</span><span class="op">(</span><span class="va">lltes</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu">colfun</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">[</span><span class="fu">scl</span><span class="op">(</span><span class="va">meanval</span><span class="op">)</span><span class="op">*</span><span class="fl">19</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, asp <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">d</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">xname</span>, <span class="va">yname</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>Grid interpolation from Dirichlet or Delaunay. This is much slower than the triangulate and cart2bary method above (<strong>Mike needs to illustrate this</strong>)</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"> 
 <span class="va">fcs.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/facets.html">facets</a></span><span class="op">(</span><span class="va">pObj</span>, nx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span><span class="op">(</span><span class="va">rbase</span><span class="op">)</span> , ny <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">rbase</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"dirichlet"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  number of triangles = 50 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,</span>
<span class="co">#&gt; 41, 42, 43, 44, 45, 46, 47, 48, 49,  50.</span>
 <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterFromXYZ.html">rasterFromXYZ</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">fcs.dir</span><span class="op">)</span><span class="op">)</span>, asp <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">fcs.del</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/facets.html">facets</a></span><span class="op">(</span><span class="va">pObj</span>, nx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span><span class="op">(</span><span class="va">rbase</span><span class="op">)</span> , ny <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">rbase</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"delaunay"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  number of triangles = 91 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,</span>
<span class="co">#&gt; 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,</span>
<span class="co">#&gt; 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,  91.</span>
 <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterFromXYZ.html">rasterFromXYZ</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">fcs.del</span><span class="op">)</span><span class="op">)</span>, asp <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-9-2.png" width="700"></p>
</div>
<div id="idw" class="section level1">
<h1 class="hasAnchor">
<a href="#idw" class="anchor"></a>IDW</h1>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/gstat/">gstat</a></span><span class="op">)</span>
<span class="va">idwfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xy</span>, <span class="va">value</span>, <span class="va">grid</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
   <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span> <span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defaultgrid.html">defaultgrid</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span>
  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="va">xy</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, lat <span class="op">=</span> <span class="va">xy</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, value <span class="op">=</span> <span class="va">value</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">lon</span><span class="op">+</span><span class="va">lat</span>
  <span class="fu"><a href="https://rdrr.io/pkg/sp/man/is.projected.html">proj4string</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/is.projected.html">proj4string</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>
  <span class="co">## inverse distance weighted (IDW)</span>
  <span class="va">mg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/gstat.html">gstat</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"value"</span>, formula <span class="op">=</span> <span class="va">value</span><span class="op">~</span><span class="fl">1</span>, locations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">d</span>, <span class="va">...</span><span class="op">)</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/interpolate.html">interpolate</a></span><span class="op">(</span><span class="va">grid</span>, <span class="va">mg</span><span class="op">)</span>          
<span class="op">}</span>


<span class="va">dw</span> <span class="op">&lt;-</span> <span class="fu">idwfun</span><span class="op">(</span><span class="va">lonlat</span>, <span class="va">val</span>, <span class="va">r0</span><span class="op">)</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="va">dw</span> <span class="op">&lt;-</span> <span class="fu">idwfun</span><span class="op">(</span><span class="va">lonlat</span>, <span class="va">val</span>, <span class="va">r0</span>, set <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>idp <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">dw</span>, asp <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>;<span class="fu"><a href="https://rdrr.io/pkg/raster/man/contour.html">contour</a></span><span class="op">(</span><span class="va">trigrid</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div id="kriging" class="section level1">
<h1 class="hasAnchor">
<a href="#kriging" class="anchor"></a>Kriging</h1>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">krifun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xy</span>, <span class="va">value</span>, <span class="va">grid</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
   <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span> <span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defaultgrid.html">defaultgrid</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span>
  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="va">xy</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, lat <span class="op">=</span> <span class="va">xy</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, value <span class="op">=</span> <span class="va">value</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">lon</span><span class="op">+</span><span class="va">lat</span>
  <span class="fu"><a href="https://rdrr.io/pkg/sp/man/is.projected.html">proj4string</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/is.projected.html">proj4string</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>
 <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/variogram.html">variogram</a></span><span class="op">(</span><span class="va">value</span><span class="op">~</span><span class="fl">1</span>, <span class="va">d</span><span class="op">)</span>
 <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/fit.variogram.html">fit.variogram</a></span><span class="op">(</span><span class="va">v</span>, <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/vgm.html">vgm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"Sph"</span>, <span class="fl">150</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
 <span class="va">gOK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/gstat.html">gstat</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="st">"value"</span>, <span class="va">value</span><span class="op">~</span><span class="fl">1</span>, <span class="va">d</span>, model<span class="op">=</span><span class="va">m</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/pkg/raster/man/interpolate.html">interpolate</a></span><span class="op">(</span><span class="va">grid</span>, <span class="va">gOK</span><span class="op">)</span>

<span class="op">}</span>
<span class="va">krigrid</span> <span class="op">&lt;-</span> <span class="fu">krifun</span><span class="op">(</span><span class="va">lonlat</span>, <span class="va">val</span>, grid <span class="op">=</span> <span class="va">r0</span><span class="op">)</span>
<span class="co">#&gt; [using ordinary kriging]</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">krigrid</span>, asp <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div id="gam" class="section level1">
<h1 class="hasAnchor">
<a href="#gam" class="anchor"></a>GAM</h1>
<p>This needs work, mgcv has more promise than this shows ;)</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: nlme</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'nlme'</span>
<span class="co">#&gt; The following object is masked from 'package:raster':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     getData</span>
<span class="co">#&gt; This is mgcv 1.8-35. For overview type 'help("mgcv-package")'.</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following object is masked from 'package:nlme':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     collapse</span>
<span class="co">#&gt; The following objects are masked from 'package:raster':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, select, union</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="va">gamfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">temp</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">Lon</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">Lat</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">bw</span>,family <span class="op">=</span> <span class="va">gaussian</span>, method <span class="op">=</span> <span class="st">"REML"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span>
<span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">bw</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lon"</span>, <span class="st">"Lat"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, nrows <span class="op">=</span> <span class="fl">50</span>, ncols <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">gamfit</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">g</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Lon <span class="op">=</span> <span class="va">x</span>, Lat <span class="op">=</span> <span class="va">y</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Lon</span>, <span class="va">Lat</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/setValues.html">setValues</a></span><span class="op">(</span><span class="va">g</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span>, asp <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div id="fields" class="section level1">
<h1 class="hasAnchor">
<a href="#fields" class="anchor"></a>fields</h1>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># out &lt;- as.image(d[,varname], x = d[,c(xname, yname)], nx = 25, ny = 25)</span>
<span class="co"># plot(raster(out))</span>
<span class="co"># look&lt;- image.smooth( out, theta= 2.5) </span>
<span class="co"># plot(raster(look))</span>

<span class="va">fsmfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xy</span>, <span class="va">value</span>, <span class="va">grid</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span> <span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defaultgrid.html">defaultgrid</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span> <span class="co">## apparently required</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fields/man/as.image.html">as.image</a></span><span class="op">(</span><span class="va">value</span>, x <span class="op">=</span> <span class="va">xy</span>, nx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>, ny <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/fields/man/image.smooth.html">image.smooth</a></span><span class="op">(</span> <span class="va">out</span>, theta<span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">)</span>
<span class="op">}</span>

<span class="va">fsmgrid</span> <span class="op">&lt;-</span> <span class="fu">fsmfun</span><span class="op">(</span><span class="va">lonlat</span>, <span class="va">val</span>, <span class="va">r0</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">fsmgrid</span>, asp <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div id="akima" class="section level1">
<h1 class="hasAnchor">
<a href="#akima" class="anchor"></a>Akima</h1>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">akima</span><span class="op">)</span>
<span class="va">akifun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xy</span>, <span class="va">value</span>, <span class="va">grid</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
     <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span> <span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defaultgrid.html">defaultgrid</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span>
  <span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/xyFromCell.html">xFromCol</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>
  <span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/xyFromCell.html">yFromRow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>

  <span class="va">aklin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/akima/man/interp.html">interp</a></span><span class="op">(</span><span class="va">xy</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">xy</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">value</span>, 
              <span class="va">x0</span>, <span class="va">y0</span>, <span class="va">...</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">aklin</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">aklin</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, z <span class="op">=</span> <span class="va">aklin</span><span class="op">$</span><span class="va">z</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span><span class="op">(</span><span class="va">aklin</span><span class="op">$</span><span class="va">z</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">akigrid</span> <span class="op">&lt;-</span> <span class="fu">akifun</span><span class="op">(</span><span class="va">lonlat</span>, <span class="va">val</span>, grid <span class="op">=</span> <span class="va">r0</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">akigrid</span>, asp <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
<div id="others" class="section level1">
<h1 class="hasAnchor">
<a href="#others" class="anchor"></a>Others</h1>
<p>Hexagons: see hexbin, spatstat.</p>
<p>sm package</p>
</div>
<div id="along-track-distance" class="section level1">
<h1 class="hasAnchor">
<a href="#along-track-distance" class="anchor"></a>Along-track distance</h1>
<p>Previously we used Latitude as our x-axis, this is not very sensible since the track visits the same latitudes at different longitudes. As a simple improvement let’s build an along-track axis.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># lonname &lt;- "Longitude [degrees_east]"</span>
<span class="co"># latname &lt;- "Latitude [degrees_north]"</span>
<span class="co"># tname &lt;- "yyyy-mm-ddThh:mm:ss.sss"</span>
<span class="co"># d2 &lt;- szt[asub, c(xname, yname, lonname, latname, varname, tname)]</span>
<span class="co"># d2$date &lt;- as.POSIXct(d2[[tname]])</span>
<span class="co"># d2 &lt;- d2[order(d2$date, d2$Depth), ]</span>
<span class="co"># library(geosphere)</span>
<span class="co"># dists &lt;- numeric(nrow(d2)-1)</span>
<span class="co"># for (i in seq_along(dists)) {</span>
<span class="co">#   dists[i] &lt;- spDistsN1(as.matrix(d2[i, c(lonname, latname)]), as.matrix(d2[i+1, c(lonname, latname), drop = FALSE]), longlat = TRUE)</span>
<span class="co">#   }</span>
<span class="co"># d2$dist &lt;- cumsum(c(0, dists))</span></code></pre></div>
<p>So now.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># xname &lt;- "dist"</span>
<span class="co"># d &lt;- d2</span>
<span class="co"># ex &lt;- extent(range(d[, xname]), range(d[, yname])) * 1.2</span>
<span class="co"># rbase &lt;- raster(ex, ncols = 25, nrows = 25)</span>
<span class="co"># rlast &lt;- rasterize(d[,c(xname, yname)], rbase, field = d[,varname])</span>
<span class="co"># </span>
<span class="co"># rmean &lt;- rasterize(d[,c(xname, yname)], rbase, field = d[,varname], fun = mean)</span>
<span class="co"># </span>
<span class="co"># rval &lt;- pretty(d[,varname], n = 15)</span>
<span class="co"># </span>
<span class="co"># plot(rlast, col = colfun(length(rval) - 1), breaks = rval, asp = 1)</span>
<span class="co"># points(d[, c(xname, yname)], cex = 0.2)</span>
<span class="co">#  plot(rmean, col = colfun(length(rval) - 1), breaks = rval, asp = 1)</span>
<span class="co"># points(d[, c(xname, yname)], cex = 0.2)</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># p &lt;- Tps(d[, c(xname, yname)], d[,varname])</span>
<span class="co"># rp &lt;- interpolate(rbase, p)</span>
<span class="co"># rpse &lt;- interpolate(rbase, p, fun = predictSE)</span>
<span class="co">#  plot(rp, col = colfun(length(rval) - 1), breaks = rval, asp = 1)</span>
<span class="co"># points(d[, c(xname, yname)], cex = 0.2)</span>
<span class="co">#  plot(rpse, col = colfun(length(rval) - 1), breaks = rval, asp = 1)</span>
<span class="co"># points(d[, c(xname, yname)], cex = 0.2)</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># ## input must be ppp</span>
<span class="co"># library(spatstat)</span>
<span class="co"># library(maptools)</span>
<span class="co"># rasterToOwin &lt;- function(x) {</span>
<span class="co">#   owin(c(xmin(x), xmax(x)), c(ymin(x), ymax(x)))</span>
<span class="co"># }</span>
<span class="co"># pObj &lt;- ppp(d[,xname], d[,yname], window = rasterToOwin(rbase), marks = d[, varname])</span>
<span class="co"># </span>
<span class="co"># lltes&lt;-delaunay(pObj)</span>
<span class="co"># meanval &lt;- numeric(length(lltes[[3]]))</span>
<span class="co">#   for (i in seq_along(meanval)) {</span>
<span class="co">#   meanval[i] &lt;- mean(marks(pObj[lltes[[3]][[i]]]))</span>
<span class="co">#        }</span>
<span class="co"># plot(as(lltes, "SpatialPolygons"), col = colfun(20)[scl(meanval)*19 + 1])</span>
<span class="co"># points(d[,c(xname, yname)])</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># lltes&lt;-dirichlet(pObj)</span>
<span class="co"># meanval &lt;- numeric(length(lltes[[3]]))</span>
<span class="co">#   for (i in seq_along(meanval)) {</span>
<span class="co">#   meanval[i] &lt;- mean(marks(pObj[lltes[[3]][[i]]]))</span>
<span class="co">#        }</span>
<span class="co"># plot(as(lltes, "SpatialPolygons"), col = colfun(20)[scl(meanval)*19 + 1])</span>
<span class="co"># points(d[,c(xname, yname)])</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># source("maybetin.R")</span>
<span class="co"># </span>
<span class="co"># fcs.dir &lt;- facets(pObj, nx = ncol(rbase) , ny = nrow(rbase), method = "dirichlet")</span>
<span class="co"># plot(rasterFromXYZ(as.data.frame(fcs.dir)))</span>
<span class="co"># fcs.del &lt;- facets(pObj, nx = ncol(rbase) , ny = nrow(rbase), method = "delaunay")</span>
<span class="co"># plot(rasterFromXYZ(as.data.frame(fcs.del)))</span>
<span class="co"># </span>
<span class="co"># library(gstat)</span>
<span class="co"># </span>
<span class="co"># dsp &lt;- d</span>
<span class="co"># coordinates(dsp) &lt;- c(xname, yname)</span>
<span class="co"># ## inverse distance weighted (IDW)</span>
<span class="co"># mg &lt;- gstat(id = "Al", formula = Al~1, locations = c(xname, yname), data=dsp, </span>
<span class="co">#             nmax=7, set=list(idp = .5))</span>
<span class="co"># z &lt;- interpolate(rbase, mg)</span>
<span class="co"># plot(z)</span>
<span class="co"># </span>
<span class="co"># ## with log</span>
<span class="co"># v &lt;- variogram(log(Al)~1, dsp)</span>
<span class="co"># m &lt;- fit.variogram(v, vgm(1, "Sph", 300, 1))</span>
<span class="co"># gOK &lt;- gstat(NULL, "logAl", log(Al)~1, dsp, model=m)</span>
<span class="co"># OK &lt;- interpolate(rbase, gOK)</span>
<span class="co"># plot(OK)</span>
<span class="co"># </span>
<span class="co"># ## without log</span>
<span class="co"># v &lt;- variogram(Al~1, dsp)</span>
<span class="co"># m &lt;- fit.variogram(v, vgm(1, "Sph", 300, 1))</span>
<span class="co"># gOK &lt;- gstat(NULL, "Al", Al~1, dsp, model=m)</span>
<span class="co"># OK &lt;- interpolate(rbase, gOK)</span>
<span class="co"># plot(OK)</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># ## Gaussian</span>
<span class="co"># v &lt;- variogram(Al~1, dsp)</span>
<span class="co"># m &lt;- fit.variogram(v, vgm(1, "Gau", 300, 1))</span>
<span class="co"># gOK &lt;- gstat(NULL, "Al", Al~1, dsp, model=m)</span>
<span class="co"># OK &lt;- interpolate(rbase, gOK)</span>
<span class="co"># plot(OK)</span>
<span class="co"># </span>
<span class="co"># out &lt;- as.image(d[,varname], x = d[,c(xname, yname)], nx = 25, ny = 25)</span>
<span class="co"># plot(raster(out))</span>
<span class="co"># look&lt;- image.smooth( out, theta= 2.5) </span>
<span class="co"># plot(raster(look))</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># library(akima)</span>
<span class="co"># </span>
<span class="co"># x0 &lt;- xFromCol(rbase)</span>
<span class="co"># y0 &lt;- yFromRow(rbase)</span>
<span class="co"># </span>
<span class="co"># aklin &lt;- interp(d[,xname], d[,yname], d[,varname], </span>
<span class="co">#               x0, y0)</span>
<span class="co"># # aksplin &lt;-interp(d[,xname], d[,yname], d[,varname], </span>
<span class="co"># #               x0, y0, linear = FALSE, extrap = TRUE) </span>
<span class="co"># rlin &lt;- raster(list(x = aklin$x, y = rev(aklin$y), z = t(aklin$z[,ncol(aklin$z):1])))</span>
<span class="co"># ##rsplin &lt;- raster(aksplin)</span>
<span class="co"># plot(rlin, col = colfun(length(rval) - 1), breaks = rval, asp = 1)</span>
<span class="co">#points(d[, c(xname, yname)], cex = 0.2)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
