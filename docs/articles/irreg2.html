<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interpolating irregular data • guerrilla</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Interpolating irregular data">
<meta property="og:description" content="guerrilla">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">guerrilla</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/irreg2.html">Interpolating irregular data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mdsumner/guerrilla/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Interpolating irregular data</h1>
                        <h4 class="author">Michael D. Sumner</h4>
            
            <h4 class="date">2020-04-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mdsumner/guerrilla/blob/master/vignettes/irreg2.Rmd"><code>vignettes/irreg2.Rmd</code></a></small>
      <div class="hidden name"><code>irreg2.Rmd</code></div>

    </div>

    
    
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>Define utility functions for repeated usage, and load required packages.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">scl</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) (<span class="no">x</span> - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">x</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>))/<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="no">x</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">guerrilla</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">raster</span>)
<span class="co">#&gt; Loading required package: sp</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">gstat</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">fields</span>)
<span class="co">#&gt; Loading required package: spam</span>
<span class="co">#&gt; Loading required package: dotCall64</span>
<span class="co">#&gt; Loading required package: grid</span>
<span class="co">#&gt; Spam version 2.5-1 (2019-12-12) is loaded.</span>
<span class="co">#&gt; Type 'help( Spam)' or 'demo( spam)' for a short introduction </span>
<span class="co">#&gt; and overview of this package.</span>
<span class="co">#&gt; Help for individual functions is also obtained by adding the</span>
<span class="co">#&gt; suffix '.spam' to the function name, e.g. 'help( chol.spam)'.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'spam'</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     backsolve, forwardsolve</span>
<span class="co">#&gt; Loading required package: maps</span>
<span class="co">#&gt; See https://github.com/NCAR/Fields for</span>
<span class="co">#&gt;  an extensive vignette, other supplements and source code</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">akima</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">palr</span>)</pre></body></html></div>
<p>Read the zooplankton data.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">readxl</span>)
<span class="no">bw</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"BW-Zooplankton_env.xls"</span>, <span class="kw">package</span><span class="kw">=</span> <span class="st">"guerrilla"</span>, <span class="kw">mustWork</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">bw</span>[,<span class="fl">1</span>:<span class="fl">10</span>])
<span class="co">#&gt;     Station            Lat              Lon            depth     </span>
<span class="co">#&gt;  Min.   :  4.00   Min.   :-69.11   Min.   :29.98   Min.   : 175  </span>
<span class="co">#&gt;  1st Qu.: 37.25   1st Qu.:-66.84   1st Qu.:40.00   1st Qu.:1523  </span>
<span class="co">#&gt;  Median : 60.00   Median :-65.84   Median :55.06   Median :3065  </span>
<span class="co">#&gt;  Mean   : 64.36   Mean   :-65.46   Mean   :54.60   Mean   :2791  </span>
<span class="co">#&gt;  3rd Qu.:100.25   3rd Qu.:-64.09   3rd Qu.:70.00   3rd Qu.:4114  </span>
<span class="co">#&gt;  Max.   :122.00   Max.   :-61.66   Max.   :80.02   Max.   :5075  </span>
<span class="co">#&gt;       temp              sal         chl a mg/m2)       ASC (km)      </span>
<span class="co">#&gt;  Min.   :-1.6712   Min.   :33.93   Min.   : 29.60   Min.   :-39.600  </span>
<span class="co">#&gt;  1st Qu.:-1.4726   1st Qu.:34.14   1st Qu.: 44.91   1st Qu.:  4.125  </span>
<span class="co">#&gt;  Median :-1.1332   Median :34.25   Median : 53.00   Median :114.950  </span>
<span class="co">#&gt;  Mean   :-0.6755   Mean   :34.22   Mean   : 76.80   Mean   :187.506  </span>
<span class="co">#&gt;  3rd Qu.: 0.1435   3rd Qu.:34.31   3rd Qu.: 85.57   3rd Qu.:330.550  </span>
<span class="co">#&gt;  Max.   : 0.8815   Max.   :34.42   Max.   :352.51   Max.   :775.500  </span>
<span class="co">#&gt;  ice free days     Total abundance   </span>
<span class="co">#&gt;  Min.   :-35.322   Min.   :   459.3  </span>
<span class="co">#&gt;  1st Qu.:  6.108   1st Qu.:  4425.9  </span>
<span class="co">#&gt;  Median : 33.153   Median : 11346.1  </span>
<span class="co">#&gt;  Mean   : 33.139   Mean   : 23609.3  </span>
<span class="co">#&gt;  3rd Qu.: 62.901   3rd Qu.: 27417.3  </span>
<span class="co">#&gt;  Max.   :101.420   Max.   :116715.8</span>
<span class="no">lonlat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span>(<span class="no">bw</span>[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Lon"</span>, <span class="st">"Lat"</span>)])
<span class="no">val</span> <span class="kw">&lt;-</span> <span class="no">bw</span>$<span class="no">temp</span>
<span class="no">minmax</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1.8</span>, <span class="fl">40</span>)

<span class="no">rval</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/pretty.html">pretty</a></span>(<span class="no">val</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">15</span>)

<span class="no">cols</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/palr/man/sst_pal.html">sst_pal</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">rval</span>) - <span class="fl">1</span>)</pre></body></html></div>
<p>Plot the temperature data.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">val</span>)</pre></body></html></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>Create a grid to interpolate onto, this can be used repeatedly for many methods.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">raster</span>)

<span class="no">r0</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/defaultgrid.html">defaultgrid</a></span>(<span class="no">lonlat</span>)</pre></body></html></div>
</div>
<div id="simplistic-rasterization" class="section level1">
<h1 class="hasAnchor">
<a href="#simplistic-rasterization" class="anchor"></a>Simplistic rasterization</h1>
<p>The most simple thing possible is to define a grid and populate that with values from points.</p>
<p>We extend the grid by a small amount, which is generally good practice.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">rasgrid</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">xy</span>, <span class="no">value</span>, <span class="no">grid</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="no">...</span>) {
  <span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">grid</span>)) <span class="no">grid</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/defaultgrid.html">defaultgrid</a></span>(<span class="no">xy</span>)
   <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterize.html">rasterize</a></span>(<span class="no">xy</span>, <span class="no">grid</span>, <span class="kw">field</span> <span class="kw">=</span> <span class="no">value</span>, <span class="no">...</span>)
}
<span class="no">lastgrid</span> <span class="kw">&lt;-</span> <span class="fu">rasgrid</span>(<span class="no">lonlat</span>, <span class="no">val</span>, <span class="no">r0</span>)

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">lastgrid</span>, <span class="kw">asp</span> <span class="kw">=</span> <span class="st">""</span>)</pre></body></html></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>The main influence on the result here is purely pixel size, and we must consider the behaviour used when there is more than one value per pixel.</p>
</div>
<div id="thin-plate-spline-interpolation-" class="section level1">
<h1 class="hasAnchor">
<a href="#thin-plate-spline-interpolation-" class="anchor"></a>Thin plate spline interpolation.</h1>
<p>This is the powerhouse behind GDAL’s raster warping, and that suggests that we could leverage GDAL by creating a data set in the right format for it to warp to.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">fields</span>)
<span class="no">tpsfun</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">xy</span>, <span class="no">value</span>, <span class="no">grid</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="no">...</span>) {
  <span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">grid</span>)) <span class="no">grid</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/defaultgrid.html">defaultgrid</a></span>(<span class="no">xy</span>)
  <span class="no">model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fields/man/Tps.html">Tps</a></span>(<span class="no">xy</span>, <span class="no">value</span>, <span class="kw">lon.lat</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/isLonLat.html">isLonLat</a></span>(<span class="no">grid</span>), <span class="kw">method</span> <span class="kw">=</span> <span class="st">"REML"</span>)
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/interpolate.html">interpolate</a></span>(<span class="no">grid</span>, <span class="no">model</span>, <span class="no">...</span>)
}
<span class="no">tpsgrid</span>  <span class="kw">&lt;-</span> <span class="fu">tpsfun</span>(<span class="no">lonlat</span>, <span class="no">val</span>)
<span class="no">tpsgrid</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/clamp.html">clamp</a></span>(<span class="no">tpsgrid</span>, <span class="no">minmax</span>[<span class="fl">1</span>], <span class="no">minmax</span>[<span class="fl">2</span>])

<span class="co">## this shows the error</span>
<span class="no">tpsSEgrid</span> <span class="kw">&lt;-</span> <span class="fu">tpsfun</span>(<span class="no">lonlat</span>, <span class="no">val</span>, <span class="no">r0</span>, <span class="kw">fun</span> <span class="kw">=</span> <span class="no">predictSE</span>)

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">tpsgrid</span>, <span class="kw">asp</span> <span class="kw">=</span> <span class="st">""</span>)</pre></body></html></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div id="bilinear-triangulation-" class="section level1">
<h1 class="hasAnchor">
<a href="#bilinear-triangulation-" class="anchor"></a>Bilinear triangulation.</h1>
<p>This is identical to Matlab’s griddata(, method = “bilinear”)</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">geometry</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sp</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">guerrilla</span>)


<span class="no">trigrid</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tri_fun.html">tri_fun</a></span>(<span class="no">lonlat</span>, <span class="no">val</span>, <span class="no">r0</span>)
<span class="co">## should be identical, generalizing for mesh3d use</span>
<span class="no">t2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mesh_raster.html">mesh_raster</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">lonlat</span>, <span class="no">val</span>), <span class="no">r0</span>)
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">trigrid</span>, <span class="kw">asp</span> <span class="kw">=</span> <span class="st">""</span>)</pre></body></html></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div id="delaunay-and-diriclet" class="section level1">
<h1 class="hasAnchor">
<a href="#delaunay-and-diriclet" class="anchor"></a>Delaunay and Diriclet</h1>
<p>What about Delaunay and Dirichlet without interpolation?</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">graphics.off</a></span>()
<span class="co">## input must be ppp</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">spatstat</span>)
<span class="co">#&gt; Loading required package: spatstat.data</span>
<span class="co">#&gt; Loading required package: nlme</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'nlme'</span>
<span class="co">#&gt; The following object is masked from 'package:raster':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     getData</span>
<span class="co">#&gt; Loading required package: rpart</span>
<span class="co">#&gt; Registered S3 method overwritten by 'spatstat':</span>
<span class="co">#&gt;   method     from</span>
<span class="co">#&gt;   print.boxx cli</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; spatstat 1.63-3       (nickname: 'Wet paint') </span>
<span class="co">#&gt; For an introduction to spatstat, type 'beginner'</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'spatstat'</span>
<span class="co">#&gt; The following object is masked from 'package:palr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     col2hex</span>
<span class="co">#&gt; The following object is masked from 'package:gstat':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     idw</span>
<span class="co">#&gt; The following objects are masked from 'package:raster':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     area, rotate, shift</span>
<span class="co">#&gt; The following object is masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     marginSums</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">maptools</span>)
<span class="co">#&gt; Checking rgeos availability: TRUE</span>
<span class="no">rasterToOwin</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="fu"><a href="https://rdrr.io/pkg/spatstat/man/owin.html">owin</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/coordinates.html">xmin</a></span>(<span class="no">x</span>), <span class="fu"><a href="https://rdrr.io/pkg/raster/man/coordinates.html">xmax</a></span>(<span class="no">x</span>)), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/coordinates.html">ymin</a></span>(<span class="no">x</span>), <span class="fu"><a href="https://rdrr.io/pkg/raster/man/coordinates.html">ymax</a></span>(<span class="no">x</span>)))
}
<span class="no">colfun</span> <span class="kw">&lt;-</span> <span class="kw pkg">viridis</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/viridis/man/reexports.html">viridis</a></span>
<span class="no">rbase</span> <span class="kw">&lt;-</span> <span class="no">r0</span>
<span class="no">d</span> <span class="kw">&lt;-</span> <span class="no">bw</span>
<span class="no">xname</span> <span class="kw">&lt;-</span> <span class="st">"Lon"</span>
<span class="no">yname</span> <span class="kw">&lt;-</span> <span class="st">"Lat"</span>
<span class="no">varname</span> <span class="kw">&lt;-</span> <span class="st">"temp"</span>
<span class="no">pObj</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/spatstat/man/ppp.html">ppp</a></span>(<span class="no">d</span><span class="kw">[[</span><span class="no">xname</span>]], <span class="no">d</span><span class="kw">[[</span><span class="no">yname</span>]], <span class="kw">window</span> <span class="kw">=</span> <span class="fu">rasterToOwin</span>(<span class="no">rbase</span>), <span class="kw">marks</span> <span class="kw">=</span> <span class="no">d</span><span class="kw">[[</span><span class="no">varname</span>]])

<span class="no">lltes</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat/man/delaunay.html">delaunay</a></span>(<span class="no">pObj</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;      PLEASE NOTE:  The components "delsgs" and "summary" of the</span>
<span class="co">#&gt;  object returned by deldir() are now DATA FRAMES rather than</span>
<span class="co">#&gt;  matrices (as they were prior to release 0.0-18).</span>
<span class="co">#&gt;  See help("deldir").</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;      PLEASE NOTE: The process that deldir() uses for determining</span>
<span class="co">#&gt;  duplicated points has changed from that used in version</span>
<span class="co">#&gt;  0.0-9 of this package (and previously). See help("deldir").</span>
<span class="no">meanval</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">lltes</span><span class="kw">[[</span><span class="fl">3</span>]]))
  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">meanval</span>)) {
  <span class="no">meanval</span>[<span class="no">i</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/spatstat/man/marks.html">marks</a></span>(<span class="no">pObj</span>[<span class="no">lltes</span><span class="kw">[[</span><span class="fl">3</span>]]<span class="kw">[[</span><span class="no">i</span>]]]))
       }
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="fu">as</span>(<span class="no">lltes</span>, <span class="st">"SpatialPolygons"</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="fu">colfun</span>(<span class="fl">20</span>)[<span class="fu">scl</span>(<span class="no">meanval</span>)*<span class="fl">19</span> + <span class="fl">1</span>], <span class="kw">asp</span> <span class="kw">=</span> <span class="st">""</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="no">d</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">xname</span>, <span class="no">yname</span>)])

<span class="no">lltes</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat/man/dirichlet.html">dirichlet</a></span>(<span class="no">pObj</span>)
<span class="no">meanval</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">lltes</span><span class="kw">[[</span><span class="fl">3</span>]]))
  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">meanval</span>)) {
  <span class="no">meanval</span>[<span class="no">i</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/spatstat/man/marks.html">marks</a></span>(<span class="no">pObj</span>[<span class="no">lltes</span><span class="kw">[[</span><span class="fl">3</span>]]<span class="kw">[[</span><span class="no">i</span>]]]))
  }

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="fu">as</span>(<span class="no">lltes</span>, <span class="st">"SpatialPolygons"</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="fu">colfun</span>(<span class="fl">20</span>)[<span class="fu">scl</span>(<span class="no">meanval</span>)*<span class="fl">19</span> + <span class="fl">1</span>], <span class="kw">asp</span> <span class="kw">=</span> <span class="fl">NA</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="no">d</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">xname</span>, <span class="no">yname</span>)])</pre></body></html></div>
<p>Grid interpolation from Dirichlet or Delaunay. This is much slower than the triangulate and cart2bary method above (<strong>Mike needs to illustrate this</strong>)</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r">
 <span class="no">fcs.dir</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/facets.html">facets</a></span>(<span class="no">pObj</span>, <span class="kw">nx</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span>(<span class="no">rbase</span>) , <span class="kw">ny</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span>(<span class="no">rbase</span>), <span class="kw">method</span> <span class="kw">=</span> <span class="st">"dirichlet"</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  number of triangles = 50 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,</span>
<span class="co">#&gt; 41, 42, 43, 44, 45, 46, 47, 48, 49,  50.</span>
 <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterFromXYZ.html">rasterFromXYZ</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span>(<span class="no">fcs.dir</span>)), <span class="kw">asp</span> <span class="kw">=</span> <span class="fl">NA</span>)</pre></body></html></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"> <span class="no">fcs.del</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/facets.html">facets</a></span>(<span class="no">pObj</span>, <span class="kw">nx</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span>(<span class="no">rbase</span>) , <span class="kw">ny</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span>(<span class="no">rbase</span>), <span class="kw">method</span> <span class="kw">=</span> <span class="st">"delaunay"</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  number of triangles = 91 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,</span>
<span class="co">#&gt; 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,</span>
<span class="co">#&gt; 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,  91.</span>
 <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterFromXYZ.html">rasterFromXYZ</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span>(<span class="no">fcs.del</span>)), <span class="kw">asp</span> <span class="kw">=</span> <span class="fl">NA</span>)</pre></body></html></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-9-2.png" width="700"></p>
</div>
<div id="idw" class="section level1">
<h1 class="hasAnchor">
<a href="#idw" class="anchor"></a>IDW</h1>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">gstat</span>)
<span class="no">idwfun</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">xy</span>, <span class="no">value</span>, <span class="no">grid</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="no">...</span>) {
   <span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">grid</span>)) <span class="no">grid</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/defaultgrid.html">defaultgrid</a></span>(<span class="no">xy</span>)
  <span class="no">d</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">lon</span> <span class="kw">=</span> <span class="no">xy</span>[,<span class="fl">1</span>], <span class="kw">lat</span> <span class="kw">=</span> <span class="no">xy</span>[,<span class="fl">2</span>], <span class="kw">value</span> <span class="kw">=</span> <span class="no">value</span>)
  <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">d</span>) <span class="kw">&lt;-</span> ~<span class="no">lon</span>+<span class="no">lat</span>
  <span class="fu"><a href="https://rdrr.io/pkg/sp/man/is.projected.html">proj4string</a></span>(<span class="no">d</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/is.projected.html">proj4string</a></span>(<span class="no">grid</span>)
  <span class="co">## inverse distance weighted (IDW)</span>
  <span class="no">mg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/gstat.html">gstat</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"value"</span>, <span class="kw">formula</span> <span class="kw">=</span> <span class="no">value</span>~<span class="fl">1</span>, <span class="kw">locations</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">d</span>, <span class="no">...</span>)
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/interpolate.html">interpolate</a></span>(<span class="no">grid</span>, <span class="no">mg</span>)
}


<span class="no">dw</span> <span class="kw">&lt;-</span> <span class="fu">idwfun</span>(<span class="no">lonlat</span>, <span class="no">val</span>, <span class="no">r0</span>)
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="no">dw</span> <span class="kw">&lt;-</span> <span class="fu">idwfun</span>(<span class="no">lonlat</span>, <span class="no">val</span>, <span class="no">r0</span>, <span class="kw">set</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">idp</span> <span class="kw">=</span> <span class="fl">1.5</span>))
<span class="co">#&gt; [inverse distance weighted interpolation]</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">dw</span>, <span class="kw">asp</span> <span class="kw">=</span> <span class="fl">NA</span>);<span class="fu"><a href="https://rdrr.io/pkg/raster/man/contour.html">contour</a></span>(<span class="no">trigrid</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div id="kriging" class="section level1">
<h1 class="hasAnchor">
<a href="#kriging" class="anchor"></a>Kriging</h1>
<div class="sourceCode" id="cb12"><html><body><pre class="r">
<span class="no">krifun</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">xy</span>, <span class="no">value</span>, <span class="no">grid</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="no">...</span>) {
   <span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">grid</span>)) <span class="no">grid</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/defaultgrid.html">defaultgrid</a></span>(<span class="no">xy</span>)
  <span class="no">d</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">lon</span> <span class="kw">=</span> <span class="no">xy</span>[,<span class="fl">1</span>], <span class="kw">lat</span> <span class="kw">=</span> <span class="no">xy</span>[,<span class="fl">2</span>], <span class="kw">value</span> <span class="kw">=</span> <span class="no">value</span>)
  <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span>(<span class="no">d</span>) <span class="kw">&lt;-</span> ~<span class="no">lon</span>+<span class="no">lat</span>
  <span class="fu"><a href="https://rdrr.io/pkg/sp/man/is.projected.html">proj4string</a></span>(<span class="no">d</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/is.projected.html">proj4string</a></span>(<span class="no">grid</span>)
 <span class="no">v</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/variogram.html">variogram</a></span>(<span class="no">value</span>~<span class="fl">1</span>, <span class="no">d</span>)
 <span class="no">m</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/fit.variogram.html">fit.variogram</a></span>(<span class="no">v</span>, <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/vgm.html">vgm</a></span>(<span class="fl">1</span>, <span class="st">"Sph"</span>, <span class="fl">150</span>, <span class="fl">1</span>))
 <span class="no">gOK</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/gstat.html">gstat</a></span>(<span class="kw">NULL</span>, <span class="st">"value"</span>, <span class="no">value</span>~<span class="fl">1</span>, <span class="no">d</span>, <span class="kw">model</span><span class="kw">=</span><span class="no">m</span>)
 <span class="fu"><a href="https://rdrr.io/pkg/raster/man/interpolate.html">interpolate</a></span>(<span class="no">grid</span>, <span class="no">gOK</span>)

}
<span class="no">krigrid</span> <span class="kw">&lt;-</span> <span class="fu">krifun</span>(<span class="no">lonlat</span>, <span class="no">val</span>, <span class="kw">grid</span> <span class="kw">=</span> <span class="no">r0</span>)
<span class="co">#&gt; [using ordinary kriging]</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">krigrid</span>, <span class="kw">asp</span> <span class="kw">=</span> <span class="st">""</span>)</pre></body></html></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div id="gam" class="section level1">
<h1 class="hasAnchor">
<a href="#gam" class="anchor"></a>GAM</h1>
<p>This needs work, mgcv has more promise than this shows ;)</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">mgcv</span>)
<span class="co">#&gt; This is mgcv 1.8-31. For overview type 'help("mgcv-package")'.</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following object is masked from 'package:nlme':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     collapse</span>
<span class="co">#&gt; The following objects are masked from 'package:raster':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, select, union</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="no">gamfit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span>(<span class="no">temp</span> ~ <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span>(<span class="no">Lon</span>)+ <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span>(<span class="no">Lat</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">bw</span>,<span class="kw">family</span> <span class="kw">=</span> <span class="no">gaussian</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"REML"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">raster</span>)
<span class="no">g</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span>(<span class="no">bw</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Lon"</span>, <span class="st">"Lat"</span>)])), <span class="kw">nrows</span> <span class="kw">=</span> <span class="fl">50</span>, <span class="kw">ncols</span> <span class="kw">=</span> <span class="fl">50</span>)
<span class="no">pred</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span>(<span class="no">gamfit</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span>(<span class="no">g</span>, <span class="kw">xy</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="kw">Lon</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">Lat</span> <span class="kw">=</span> <span class="no">y</span>) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">Lon</span>, <span class="no">Lat</span>))
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/setValues.html">setValues</a></span>(<span class="no">g</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">pred</span>)), <span class="kw">asp</span> <span class="kw">=</span> <span class="st">""</span>)</pre></body></html></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div id="fields" class="section level1">
<h1 class="hasAnchor">
<a href="#fields" class="anchor"></a>fields</h1>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co"># out &lt;- as.image(d[,varname], x = d[,c(xname, yname)], nx = 25, ny = 25)</span>
<span class="co"># plot(raster(out))</span>
<span class="co"># look&lt;- image.smooth( out, theta= 2.5) </span>
<span class="co"># plot(raster(look))</span>

<span class="no">fsmfun</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">xy</span>, <span class="no">value</span>, <span class="no">grid</span> <span class="kw">=</span> <span class="kw">NULL</span>) {
    <span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">grid</span>)) <span class="no">grid</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/defaultgrid.html">defaultgrid</a></span>(<span class="no">xy</span>)
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span>(<span class="no">grid</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span>(<span class="no">grid</span>) <span class="co">## apparently required</span>
  <span class="no">out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fields/man/as.image.html">as.image</a></span>(<span class="no">value</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">xy</span>, <span class="kw">nx</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span>(<span class="no">grid</span>), <span class="kw">ny</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span>(<span class="no">grid</span>))
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/fields/man/image.smooth.html">image.smooth</a></span>( <span class="no">out</span>, <span class="kw">theta</span><span class="kw">=</span> <span class="fl">2.5</span>) )
}

<span class="no">fsmgrid</span> <span class="kw">&lt;-</span> <span class="fu">fsmfun</span>(<span class="no">lonlat</span>, <span class="no">val</span>, <span class="no">r0</span>)
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">fsmgrid</span>, <span class="kw">asp</span> <span class="kw">=</span> <span class="st">""</span>)</pre></body></html></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div id="akima" class="section level1">
<h1 class="hasAnchor">
<a href="#akima" class="anchor"></a>Akima</h1>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">akima</span>)
<span class="no">akifun</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">xy</span>, <span class="no">value</span>, <span class="no">grid</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="no">...</span>) {
     <span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">grid</span>)) <span class="no">grid</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/defaultgrid.html">defaultgrid</a></span>(<span class="no">xy</span>)
  <span class="no">x0</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/xyFromCell.html">xFromCol</a></span>(<span class="no">grid</span>)
  <span class="no">y0</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/xyFromCell.html">yFromRow</a></span>(<span class="no">grid</span>)

  <span class="no">aklin</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/akima/man/interp.html">interp</a></span>(<span class="no">xy</span>[,<span class="fl">1</span>], <span class="no">xy</span>[,<span class="fl">2</span>], <span class="no">value</span>,
              <span class="no">x0</span>, <span class="no">y0</span>, <span class="no">...</span>)
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">aklin</span>$<span class="no">x</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="no">aklin</span>$<span class="no">y</span>), <span class="kw">z</span> <span class="kw">=</span> <span class="no">aklin</span>$<span class="no">z</span>[,<span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span>(<span class="no">aklin</span>$<span class="no">z</span>):<span class="fl">1</span>]))
}

<span class="no">akigrid</span> <span class="kw">&lt;-</span> <span class="fu">akifun</span>(<span class="no">lonlat</span>, <span class="no">val</span>, <span class="kw">grid</span> <span class="kw">=</span> <span class="no">r0</span>)
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">akigrid</span>, <span class="kw">asp</span> <span class="kw">=</span> <span class="st">""</span>)</pre></body></html></div>
<p><img src="irreg2_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
<div id="others" class="section level1">
<h1 class="hasAnchor">
<a href="#others" class="anchor"></a>Others</h1>
<p>Hexagons: see hexbin, spatstat.</p>
<p>sm package</p>
</div>
<div id="along-track-distance" class="section level1">
<h1 class="hasAnchor">
<a href="#along-track-distance" class="anchor"></a>Along-track distance</h1>
<p>Previously we used Latitude as our x-axis, this is not very sensible since the track visits the same latitudes at different longitudes. As a simple improvement let’s build an along-track axis.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"># lonname &lt;- "Longitude [degrees_east]"
# latname &lt;- "Latitude [degrees_north]"
# tname &lt;- "yyyy-mm-ddThh:mm:ss.sss"
# d2 &lt;- szt[asub, c(xname, yname, lonname, latname, varname, tname)]
# d2$date &lt;- as.POSIXct(d2[[tname]])
# d2 &lt;- d2[order(d2$date, d2$Depth), ]
# library(geosphere)
# dists &lt;- numeric(nrow(d2)-1)
# for (i in seq_along(dists)) {
#   dists[i] &lt;- spDistsN1(as.matrix(d2[i, c(lonname, latname)]), as.matrix(d2[i+1, c(lonname, latname), drop = FALSE]), longlat = TRUE)
#   }
# d2$dist &lt;- cumsum(c(0, dists))</pre></body></html></div>
<p>So now.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"># xname &lt;- "dist"
# d &lt;- d2
# ex &lt;- extent(range(d[, xname]), range(d[, yname])) * 1.2
# rbase &lt;- raster(ex, ncols = 25, nrows = 25)
# rlast &lt;- rasterize(d[,c(xname, yname)], rbase, field = d[,varname])
# 
# rmean &lt;- rasterize(d[,c(xname, yname)], rbase, field = d[,varname], fun = mean)
# 
# rval &lt;- pretty(d[,varname], n = 15)
# 
# plot(rlast, col = colfun(length(rval) - 1), breaks = rval, asp = 1)
# points(d[, c(xname, yname)], cex = 0.2)
#  plot(rmean, col = colfun(length(rval) - 1), breaks = rval, asp = 1)
# points(d[, c(xname, yname)], cex = 0.2)
# 
# 
# p &lt;- Tps(d[, c(xname, yname)], d[,varname])
# rp &lt;- interpolate(rbase, p)
# rpse &lt;- interpolate(rbase, p, fun = predictSE)
#  plot(rp, col = colfun(length(rval) - 1), breaks = rval, asp = 1)
# points(d[, c(xname, yname)], cex = 0.2)
#  plot(rpse, col = colfun(length(rval) - 1), breaks = rval, asp = 1)
# points(d[, c(xname, yname)], cex = 0.2)
# 
# 
# ## input must be ppp
# library(spatstat)
# library(maptools)
# rasterToOwin &lt;- function(x) {
#   owin(c(xmin(x), xmax(x)), c(ymin(x), ymax(x)))
# }
# pObj &lt;- ppp(d[,xname], d[,yname], window = rasterToOwin(rbase), marks = d[, varname])
# 
# lltes&lt;-delaunay(pObj)
# meanval &lt;- numeric(length(lltes[[3]]))
#   for (i in seq_along(meanval)) {
#   meanval[i] &lt;- mean(marks(pObj[lltes[[3]][[i]]]))
#        }
# plot(as(lltes, "SpatialPolygons"), col = colfun(20)[scl(meanval)*19 + 1])
# points(d[,c(xname, yname)])
# 
# 
# lltes&lt;-dirichlet(pObj)
# meanval &lt;- numeric(length(lltes[[3]]))
#   for (i in seq_along(meanval)) {
#   meanval[i] &lt;- mean(marks(pObj[lltes[[3]][[i]]]))
#        }
# plot(as(lltes, "SpatialPolygons"), col = colfun(20)[scl(meanval)*19 + 1])
# points(d[,c(xname, yname)])
# 
# 
# source("maybetin.R")
# 
# fcs.dir &lt;- facets(pObj, nx = ncol(rbase) , ny = nrow(rbase), method = "dirichlet")
# plot(rasterFromXYZ(as.data.frame(fcs.dir)))
# fcs.del &lt;- facets(pObj, nx = ncol(rbase) , ny = nrow(rbase), method = "delaunay")
# plot(rasterFromXYZ(as.data.frame(fcs.del)))
# 
# library(gstat)
# 
# dsp &lt;- d
# coordinates(dsp) &lt;- c(xname, yname)
# ## inverse distance weighted (IDW)
# mg &lt;- gstat(id = "Al", formula = Al~1, locations = c(xname, yname), data=dsp, 
#             nmax=7, set=list(idp = .5))
# z &lt;- interpolate(rbase, mg)
# plot(z)
# 
# ## with log
# v &lt;- variogram(log(Al)~1, dsp)
# m &lt;- fit.variogram(v, vgm(1, "Sph", 300, 1))
# gOK &lt;- gstat(NULL, "logAl", log(Al)~1, dsp, model=m)
# OK &lt;- interpolate(rbase, gOK)
# plot(OK)
# 
# ## without log
# v &lt;- variogram(Al~1, dsp)
# m &lt;- fit.variogram(v, vgm(1, "Sph", 300, 1))
# gOK &lt;- gstat(NULL, "Al", Al~1, dsp, model=m)
# OK &lt;- interpolate(rbase, gOK)
# plot(OK)
# 
# 
# ## Gaussian
# v &lt;- variogram(Al~1, dsp)
# m &lt;- fit.variogram(v, vgm(1, "Gau", 300, 1))
# gOK &lt;- gstat(NULL, "Al", Al~1, dsp, model=m)
# OK &lt;- interpolate(rbase, gOK)
# plot(OK)
# 
# out &lt;- as.image(d[,varname], x = d[,c(xname, yname)], nx = 25, ny = 25)
# plot(raster(out))
# look&lt;- image.smooth( out, theta= 2.5) 
# plot(raster(look))
# 
# 
# library(akima)
# 
# x0 &lt;- xFromCol(rbase)
# y0 &lt;- yFromRow(rbase)
# 
# aklin &lt;- interp(d[,xname], d[,yname], d[,varname], 
#               x0, y0)
# # aksplin &lt;-interp(d[,xname], d[,yname], d[,varname], 
# #               x0, y0, linear = FALSE, extrap = TRUE) 
# rlin &lt;- raster(list(x = aklin$x, y = rev(aklin$y), z = t(aklin$z[,ncol(aklin$z):1])))
# ##rsplin &lt;- raster(aksplin)
# plot(rlin, col = colfun(length(rval) - 1), breaks = rval, asp = 1)
#points(d[, c(xname, yname)], cex = 0.2)</pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
